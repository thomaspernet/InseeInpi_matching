{"GLOBAL": {"DATABASE": "ets_inpi", "QUERIES_OUTPUT": "SQL_OUTPUT_ATHENA"}, "TABLES": {"CREATION": {"ALL_SCHEMA": [{"database": "ets_inpi", "name": "ets_initial", "output_id": "fbad97a5-447b-40ba-bf33-1ccba5781e3d", "separator": ";", "s3URI": "s3://calfdata/INPI/TC_1/01_donnee_source/Stock/Stock_Initial/2017/ETS", "schema": [{"Name": "code_greffe", "Type": "string", "Comment": ""}, {"Name": "nom_greffe", "Type": "string", "Comment": ""}, {"Name": "numero_gestion", "Type": "string", "Comment": ""}, {"Name": "siren", "Type": "string", "Comment": ""}, {"Name": "type", "Type": "string", "Comment": ""}, {"Name": "siege_pm", "Type": "string", "Comment": ""}, {"Name": "rcs_registre", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne1", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne2", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne3", "Type": "string", "Comment": ""}, {"Name": "code_postal", "Type": "string", "Comment": ""}, {"Name": "ville", "Type": "string", "Comment": ""}, {"Name": "code_commune", "Type": "string", "Comment": ""}, {"Name": "pays", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_nom", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_siren", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_greffe", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_complement", "Type": "string", "Comment": ""}, {"Name": "siege_domicile_representant", "Type": "string", "Comment": ""}, {"Name": "nom_commercial", "Type": "string", "Comment": ""}, {"Name": "enseigne", "Type": "string", "Comment": ""}, {"Name": "activite_ambulante", "Type": "string", "Comment": ""}, {"Name": "activite_saisonniere", "Type": "string", "Comment": ""}, {"Name": "activite_non_sedentaire", "Type": "string", "Comment": ""}, {"Name": "date_debut_activite", "Type": "string", "Comment": ""}, {"Name": "activite", "Type": "string", "Comment": ""}, {"Name": "origine_fonds", "Type": "string", "Comment": ""}, {"Name": "origine_fonds_info", "Type": "string", "Comment": ""}, {"Name": "type_exploitation", "Type": "string", "Comment": ""}, {"Name": "id_etablissement", "Type": "string", "Comment": ""}, {"Name": "date_greffe", "Type": "string", "Comment": ""}, {"Name": "libelle_evt", "Type": "string", "Comment": ""}, {"Name": "csv_source", "Type": "string", "Comment": ""}, {"Name": "nature", "Type": "string", "Comment": ""}, {"Name": "type_data", "Type": "string", "Comment": ""}, {"Name": "origin", "Type": "string", "Comment": ""}, {"Name": "file_timestamp", "Type": "string", "Comment": ""}]}, {"database": "ets_inpi", "name": "ets_partiel_2018", "output_id": "3a76749a-b211-476b-812d-79c73c18f8b7", "separator": ";", "s3URI": "s3://calfdata/INPI/TC_1/01_donnee_source/Stock/Stock_Partiel/2018/ETS", "schema": [{"Name": "code_greffe", "Type": "string", "Comment": ""}, {"Name": "nom_greffe", "Type": "string", "Comment": ""}, {"Name": "numero_gestion", "Type": "string", "Comment": ""}, {"Name": "siren", "Type": "string", "Comment": ""}, {"Name": "type", "Type": "string", "Comment": ""}, {"Name": "siege_pm", "Type": "string", "Comment": ""}, {"Name": "rcs_registre", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne1", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne2", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne3", "Type": "string", "Comment": ""}, {"Name": "code_postal", "Type": "string", "Comment": ""}, {"Name": "ville", "Type": "string", "Comment": ""}, {"Name": "code_commune", "Type": "string", "Comment": ""}, {"Name": "pays", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_nom", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_siren", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_greffe", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_complement", "Type": "string", "Comment": ""}, {"Name": "siege_domicile_representant", "Type": "string", "Comment": ""}, {"Name": "nom_commercial", "Type": "string", "Comment": ""}, {"Name": "enseigne", "Type": "string", "Comment": ""}, {"Name": "activite_ambulante", "Type": "string", "Comment": ""}, {"Name": "activite_saisonniere", "Type": "string", "Comment": ""}, {"Name": "activite_non_sedentaire", "Type": "string", "Comment": ""}, {"Name": "date_debut_activite", "Type": "string", "Comment": ""}, {"Name": "activite", "Type": "string", "Comment": ""}, {"Name": "origine_fonds", "Type": "string", "Comment": ""}, {"Name": "origine_fonds_info", "Type": "string", "Comment": ""}, {"Name": "type_exploitation", "Type": "string", "Comment": ""}, {"Name": "id_etablissement", "Type": "string", "Comment": ""}, {"Name": "date_greffe", "Type": "string", "Comment": ""}, {"Name": "libelle_evt", "Type": "string", "Comment": ""}, {"Name": "csv_source", "Type": "string", "Comment": ""}, {"Name": "nature", "Type": "string", "Comment": ""}, {"Name": "type_data", "Type": "string", "Comment": ""}, {"Name": "origin", "Type": "string", "Comment": ""}, {"Name": "file_timestamp", "Type": "string", "Comment": ""}]}, {"database": "ets_inpi", "name": "ets_partiel_2019", "output_id": "b9ff0702-45df-48be-aab2-204f0f559363", "separator": ";", "s3URI": "s3://calfdata/INPI/TC_1/01_donnee_source/Stock/Stock_Partiel/2019/ETS", "schema": [{"Name": "code_greffe", "Type": "string", "Comment": ""}, {"Name": "nom_greffe", "Type": "string", "Comment": ""}, {"Name": "numero_gestion", "Type": "string", "Comment": ""}, {"Name": "siren", "Type": "string", "Comment": ""}, {"Name": "type", "Type": "string", "Comment": ""}, {"Name": "siege_pm", "Type": "string", "Comment": ""}, {"Name": "rcs_registre", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne1", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne2", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne3", "Type": "string", "Comment": ""}, {"Name": "code_postal", "Type": "string", "Comment": ""}, {"Name": "ville", "Type": "string", "Comment": ""}, {"Name": "code_commune", "Type": "string", "Comment": ""}, {"Name": "pays", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_nom", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_siren", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_greffe", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_complement", "Type": "string", "Comment": ""}, {"Name": "siege_domicile_representant", "Type": "string", "Comment": ""}, {"Name": "nom_commercial", "Type": "string", "Comment": ""}, {"Name": "enseigne", "Type": "string", "Comment": ""}, {"Name": "activite_ambulante", "Type": "string", "Comment": ""}, {"Name": "activite_saisonniere", "Type": "string", "Comment": ""}, {"Name": "activite_non_sedentaire", "Type": "string", "Comment": ""}, {"Name": "date_debut_activite", "Type": "string", "Comment": ""}, {"Name": "activite", "Type": "string", "Comment": ""}, {"Name": "origine_fonds", "Type": "string", "Comment": ""}, {"Name": "origine_fonds_info", "Type": "string", "Comment": ""}, {"Name": "type_exploitation", "Type": "string", "Comment": ""}, {"Name": "id_etablissement", "Type": "string", "Comment": ""}, {"Name": "date_greffe", "Type": "string", "Comment": ""}, {"Name": "libelle_evt", "Type": "string", "Comment": ""}, {"Name": "csv_source", "Type": "string", "Comment": ""}, {"Name": "nature", "Type": "string", "Comment": ""}, {"Name": "type_data", "Type": "string", "Comment": ""}, {"Name": "origin", "Type": "string", "Comment": ""}, {"Name": "file_timestamp", "Type": "string", "Comment": ""}]}, {"database": "ets_inpi", "name": "ets_new_2017", "output_id": "e7b31a49-5553-4cb6-8588-4f271a38e149", "separator": ";", "s3URI": "s3://calfdata/INPI/TC_1/01_donnee_source/Flux/2017/ETS/NEW", "schema": [{"Name": "code_greffe", "Type": "string", "Comment": ""}, {"Name": "nom_greffe", "Type": "string", "Comment": ""}, {"Name": "numero_gestion", "Type": "string", "Comment": ""}, {"Name": "siren", "Type": "string", "Comment": ""}, {"Name": "type", "Type": "string", "Comment": ""}, {"Name": "siege_pm", "Type": "string", "Comment": ""}, {"Name": "rcs_registre", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne1", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne2", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne3", "Type": "string", "Comment": ""}, {"Name": "code_postal", "Type": "string", "Comment": ""}, {"Name": "ville", "Type": "string", "Comment": ""}, {"Name": "code_commune", "Type": "string", "Comment": ""}, {"Name": "pays", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_nom", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_siren", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_greffe", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_complement", "Type": "string", "Comment": ""}, {"Name": "siege_domicile_representant", "Type": "string", "Comment": ""}, {"Name": "nom_commercial", "Type": "string", "Comment": ""}, {"Name": "enseigne", "Type": "string", "Comment": ""}, {"Name": "activite_ambulante", "Type": "string", "Comment": ""}, {"Name": "activite_saisonniere", "Type": "string", "Comment": ""}, {"Name": "activite_non_sedentaire", "Type": "string", "Comment": ""}, {"Name": "date_debut_activite", "Type": "string", "Comment": ""}, {"Name": "activite", "Type": "string", "Comment": ""}, {"Name": "origine_fonds", "Type": "string", "Comment": ""}, {"Name": "origine_fonds_info", "Type": "string", "Comment": ""}, {"Name": "type_exploitation", "Type": "string", "Comment": ""}, {"Name": "id_etablissement", "Type": "string", "Comment": ""}, {"Name": "date_greffe", "Type": "string", "Comment": ""}, {"Name": "libelle_evt", "Type": "string", "Comment": ""}, {"Name": "csv_source", "Type": "string", "Comment": ""}, {"Name": "nature", "Type": "string", "Comment": ""}, {"Name": "type_data", "Type": "string", "Comment": ""}, {"Name": "origin", "Type": "string", "Comment": ""}, {"Name": "file_timestamp", "Type": "string", "Comment": ""}]}, {"database": "ets_inpi", "name": "ets_new_2018", "output_id": "44aabc09-9145-4e75-ac55-a786333e30dd", "separator": ";", "s3URI": "s3://calfdata/INPI/TC_1/01_donnee_source/Flux/2018/ETS/NEW", "schema": [{"Name": "code_greffe", "Type": "string", "Comment": ""}, {"Name": "nom_greffe", "Type": "string", "Comment": ""}, {"Name": "numero_gestion", "Type": "string", "Comment": ""}, {"Name": "siren", "Type": "string", "Comment": ""}, {"Name": "type", "Type": "string", "Comment": ""}, {"Name": "siege_pm", "Type": "string", "Comment": ""}, {"Name": "rcs_registre", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne1", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne2", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne3", "Type": "string", "Comment": ""}, {"Name": "code_postal", "Type": "string", "Comment": ""}, {"Name": "ville", "Type": "string", "Comment": ""}, {"Name": "code_commune", "Type": "string", "Comment": ""}, {"Name": "pays", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_nom", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_siren", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_greffe", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_complement", "Type": "string", "Comment": ""}, {"Name": "siege_domicile_representant", "Type": "string", "Comment": ""}, {"Name": "nom_commercial", "Type": "string", "Comment": ""}, {"Name": "enseigne", "Type": "string", "Comment": ""}, {"Name": "activite_ambulante", "Type": "string", "Comment": ""}, {"Name": "activite_saisonniere", "Type": "string", "Comment": ""}, {"Name": "activite_non_sedentaire", "Type": "string", "Comment": ""}, {"Name": "date_debut_activite", "Type": "string", "Comment": ""}, {"Name": "activite", "Type": "string", "Comment": ""}, {"Name": "origine_fonds", "Type": "string", "Comment": ""}, {"Name": "origine_fonds_info", "Type": "string", "Comment": ""}, {"Name": "type_exploitation", "Type": "string", "Comment": ""}, {"Name": "id_etablissement", "Type": "string", "Comment": ""}, {"Name": "date_greffe", "Type": "string", "Comment": ""}, {"Name": "libelle_evt", "Type": "string", "Comment": ""}, {"Name": "csv_source", "Type": "string", "Comment": ""}, {"Name": "nature", "Type": "string", "Comment": ""}, {"Name": "type_data", "Type": "string", "Comment": ""}, {"Name": "origin", "Type": "string", "Comment": ""}, {"Name": "file_timestamp", "Type": "string", "Comment": ""}]}, {"database": "ets_inpi", "name": "ets_new_2019", "output_id": "43dc4e72-1d4d-4f69-8e30-6aceb4c7bf5e", "separator": ";", "s3URI": "s3://calfdata/INPI/TC_1/01_donnee_source/Flux/2019/ETS/NEW", "schema": [{"Name": "code_greffe", "Type": "string", "Comment": ""}, {"Name": "nom_greffe", "Type": "string", "Comment": ""}, {"Name": "numero_gestion", "Type": "string", "Comment": ""}, {"Name": "siren", "Type": "string", "Comment": ""}, {"Name": "type", "Type": "string", "Comment": ""}, {"Name": "siege_pm", "Type": "string", "Comment": ""}, {"Name": "rcs_registre", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne1", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne2", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne3", "Type": "string", "Comment": ""}, {"Name": "code_postal", "Type": "string", "Comment": ""}, {"Name": "ville", "Type": "string", "Comment": ""}, {"Name": "code_commune", "Type": "string", "Comment": ""}, {"Name": "pays", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_nom", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_siren", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_greffe", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_complement", "Type": "string", "Comment": ""}, {"Name": "siege_domicile_representant", "Type": "string", "Comment": ""}, {"Name": "nom_commercial", "Type": "string", "Comment": ""}, {"Name": "enseigne", "Type": "string", "Comment": ""}, {"Name": "activite_ambulante", "Type": "string", "Comment": ""}, {"Name": "activite_saisonniere", "Type": "string", "Comment": ""}, {"Name": "activite_non_sedentaire", "Type": "string", "Comment": ""}, {"Name": "date_debut_activite", "Type": "string", "Comment": ""}, {"Name": "activite", "Type": "string", "Comment": ""}, {"Name": "origine_fonds", "Type": "string", "Comment": ""}, {"Name": "origine_fonds_info", "Type": "string", "Comment": ""}, {"Name": "type_exploitation", "Type": "string", "Comment": ""}, {"Name": "id_etablissement", "Type": "string", "Comment": ""}, {"Name": "date_greffe", "Type": "string", "Comment": ""}, {"Name": "libelle_evt", "Type": "string", "Comment": ""}, {"Name": "csv_source", "Type": "string", "Comment": ""}, {"Name": "nature", "Type": "string", "Comment": ""}, {"Name": "type_data", "Type": "string", "Comment": ""}, {"Name": "origin", "Type": "string", "Comment": ""}, {"Name": "file_timestamp", "Type": "string", "Comment": ""}]}, {"database": "ets_inpi", "name": "ets_evt_2017", "output_id": "adcf654f-ed2e-4df5-be52-804e2dec7e84", "separator": ";", "s3URI": "s3://calfdata/INPI/TC_1/01_donnee_source/Flux/2017/ETS/EVT", "schema": [{"Name": "code_greffe", "Type": "string", "Comment": ""}, {"Name": "nom_greffe", "Type": "string", "Comment": ""}, {"Name": "numero_gestion", "Type": "string", "Comment": ""}, {"Name": "siren", "Type": "string", "Comment": ""}, {"Name": "type", "Type": "string", "Comment": ""}, {"Name": "siege_pm", "Type": "string", "Comment": ""}, {"Name": "rcs_registre", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne1", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne2", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne3", "Type": "string", "Comment": ""}, {"Name": "code_postal", "Type": "string", "Comment": ""}, {"Name": "ville", "Type": "string", "Comment": ""}, {"Name": "code_commune", "Type": "string", "Comment": ""}, {"Name": "pays", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_nom", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_siren", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_greffe", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_complement", "Type": "string", "Comment": ""}, {"Name": "siege_domicile_representant", "Type": "string", "Comment": ""}, {"Name": "nom_commercial", "Type": "string", "Comment": ""}, {"Name": "enseigne", "Type": "string", "Comment": ""}, {"Name": "activite_ambulante", "Type": "string", "Comment": ""}, {"Name": "activite_saisonniere", "Type": "string", "Comment": ""}, {"Name": "activite_non_sedentaire", "Type": "string", "Comment": ""}, {"Name": "date_debut_activite", "Type": "string", "Comment": ""}, {"Name": "activite", "Type": "string", "Comment": ""}, {"Name": "origine_fonds", "Type": "string", "Comment": ""}, {"Name": "origine_fonds_info", "Type": "string", "Comment": ""}, {"Name": "type_exploitation", "Type": "string", "Comment": ""}, {"Name": "id_etablissement", "Type": "string", "Comment": ""}, {"Name": "date_greffe", "Type": "string", "Comment": ""}, {"Name": "libelle_evt", "Type": "string", "Comment": ""}, {"Name": "csv_source", "Type": "string", "Comment": ""}, {"Name": "nature", "Type": "string", "Comment": ""}, {"Name": "type_data", "Type": "string", "Comment": ""}, {"Name": "origin", "Type": "string", "Comment": ""}, {"Name": "file_timestamp", "Type": "string", "Comment": ""}]}, {"database": "ets_inpi", "name": "ets_evt_2018", "output_id": "8b82ee14-da9b-464a-b2fe-9329f5158628", "separator": ";", "s3URI": "s3://calfdata/INPI/TC_1/01_donnee_source/Flux/2018/ETS/EVT", "schema": [{"Name": "code_greffe", "Type": "string", "Comment": ""}, {"Name": "nom_greffe", "Type": "string", "Comment": ""}, {"Name": "numero_gestion", "Type": "string", "Comment": ""}, {"Name": "siren", "Type": "string", "Comment": ""}, {"Name": "type", "Type": "string", "Comment": ""}, {"Name": "siege_pm", "Type": "string", "Comment": ""}, {"Name": "rcs_registre", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne1", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne2", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne3", "Type": "string", "Comment": ""}, {"Name": "code_postal", "Type": "string", "Comment": ""}, {"Name": "ville", "Type": "string", "Comment": ""}, {"Name": "code_commune", "Type": "string", "Comment": ""}, {"Name": "pays", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_nom", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_siren", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_greffe", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_complement", "Type": "string", "Comment": ""}, {"Name": "siege_domicile_representant", "Type": "string", "Comment": ""}, {"Name": "nom_commercial", "Type": "string", "Comment": ""}, {"Name": "enseigne", "Type": "string", "Comment": ""}, {"Name": "activite_ambulante", "Type": "string", "Comment": ""}, {"Name": "activite_saisonniere", "Type": "string", "Comment": ""}, {"Name": "activite_non_sedentaire", "Type": "string", "Comment": ""}, {"Name": "date_debut_activite", "Type": "string", "Comment": ""}, {"Name": "activite", "Type": "string", "Comment": ""}, {"Name": "origine_fonds", "Type": "string", "Comment": ""}, {"Name": "origine_fonds_info", "Type": "string", "Comment": ""}, {"Name": "type_exploitation", "Type": "string", "Comment": ""}, {"Name": "id_etablissement", "Type": "string", "Comment": ""}, {"Name": "date_greffe", "Type": "string", "Comment": ""}, {"Name": "libelle_evt", "Type": "string", "Comment": ""}, {"Name": "csv_source", "Type": "string", "Comment": ""}, {"Name": "nature", "Type": "string", "Comment": ""}, {"Name": "type_data", "Type": "string", "Comment": ""}, {"Name": "origin", "Type": "string", "Comment": ""}, {"Name": "file_timestamp", "Type": "string", "Comment": ""}]}, {"database": "ets_inpi", "name": "ets_evt_2019", "output_id": "eb5d930c-c831-4f8b-af95-b22be87e972c", "separator": ";", "s3URI": "s3://calfdata/INPI/TC_1/01_donnee_source/Flux/2019/ETS/EVT", "schema": [{"Name": "code_greffe", "Type": "string", "Comment": ""}, {"Name": "nom_greffe", "Type": "string", "Comment": ""}, {"Name": "numero_gestion", "Type": "string", "Comment": ""}, {"Name": "siren", "Type": "string", "Comment": ""}, {"Name": "type", "Type": "string", "Comment": ""}, {"Name": "siege_pm", "Type": "string", "Comment": ""}, {"Name": "rcs_registre", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne1", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne2", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne3", "Type": "string", "Comment": ""}, {"Name": "code_postal", "Type": "string", "Comment": ""}, {"Name": "ville", "Type": "string", "Comment": ""}, {"Name": "code_commune", "Type": "string", "Comment": ""}, {"Name": "pays", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_nom", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_siren", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_greffe", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_complement", "Type": "string", "Comment": ""}, {"Name": "siege_domicile_representant", "Type": "string", "Comment": ""}, {"Name": "nom_commercial", "Type": "string", "Comment": ""}, {"Name": "enseigne", "Type": "string", "Comment": ""}, {"Name": "activite_ambulante", "Type": "string", "Comment": ""}, {"Name": "activite_saisonniere", "Type": "string", "Comment": ""}, {"Name": "activite_non_sedentaire", "Type": "string", "Comment": ""}, {"Name": "date_debut_activite", "Type": "string", "Comment": ""}, {"Name": "activite", "Type": "string", "Comment": ""}, {"Name": "origine_fonds", "Type": "string", "Comment": ""}, {"Name": "origine_fonds_info", "Type": "string", "Comment": ""}, {"Name": "type_exploitation", "Type": "string", "Comment": ""}, {"Name": "id_etablissement", "Type": "string", "Comment": ""}, {"Name": "date_greffe", "Type": "string", "Comment": ""}, {"Name": "libelle_evt", "Type": "string", "Comment": ""}, {"Name": "csv_source", "Type": "string", "Comment": ""}, {"Name": "nature", "Type": "string", "Comment": ""}, {"Name": "type_data", "Type": "string", "Comment": ""}, {"Name": "origin", "Type": "string", "Comment": ""}, {"Name": "file_timestamp", "Type": "string", "Comment": ""}]}, {"database": "ets_inpi", "name": "ets_flux_filtre_enrichie_timestamp", "output_id": "", "separator": ",", "s3URI": "s3://calfdata/INPI/TC_1/02_preparation_donnee/TEMP_ETS_FLUX", "schema": [{"Name": "siren", "Type": "string", "Comment": ""}, {"Name": "code_greffe", "Type": "string", "Comment": ""}, {"Name": "nom_greffe", "Type": "string", "Comment": ""}, {"Name": "numero_gestion", "Type": "string", "Comment": ""}, {"Name": "id_etablissement", "Type": "string", "Comment": ""}, {"Name": "file_timestamp", "Type": "string", "Comment": ""}, {"Name": "libelle_evt", "Type": "string", "Comment": ""}, {"Name": "date_greffe", "Type": "string", "Comment": ""}, {"Name": "type", "Type": "string", "Comment": ""}, {"Name": "siege_pm", "Type": "string", "Comment": ""}, {"Name": "rcs_registre", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne1", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne2", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne3", "Type": "string", "Comment": ""}, {"Name": "code_postal", "Type": "string", "Comment": ""}, {"Name": "ville", "Type": "string", "Comment": ""}, {"Name": "code_commune", "Type": "string", "Comment": ""}, {"Name": "pays", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_nom", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_siren", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_greffe", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_complement", "Type": "string", "Comment": ""}, {"Name": "siege_domicile_representant", "Type": "string", "Comment": ""}, {"Name": "nom_commercial", "Type": "string", "Comment": ""}, {"Name": "enseigne", "Type": "string", "Comment": ""}, {"Name": "activite_ambulante", "Type": "string", "Comment": ""}, {"Name": "activite_saisonniere", "Type": "string", "Comment": ""}, {"Name": "activite_non_sedentaire", "Type": "string", "Comment": ""}, {"Name": "date_debut_activite", "Type": "string", "Comment": ""}, {"Name": "activite", "Type": "string", "Comment": ""}, {"Name": "origine_fonds", "Type": "string", "Comment": ""}, {"Name": "origine_fonds_info", "Type": "string", "Comment": ""}, {"Name": "type_exploitation", "Type": "string", "Comment": ""}, {"Name": "csv_source", "Type": "string", "Comment": ""}]}, {"database": "ets_inpi", "name": "ets_flux_filtre_enrichie_date_greffe", "output_id": "", "separator": ",", "s3URI": "s3://calfdata/INPI/TC_1/02_preparation_donnee/TEMP_ETS_FLUX_FILTRE", "schema": [{"Name": "siren", "Type": "string", "Comment": ""}, {"Name": "code_greffe", "Type": "string", "Comment": ""}, {"Name": "nom_greffe", "Type": "string", "Comment": ""}, {"Name": "numero_gestion", "Type": "string", "Comment": ""}, {"Name": "id_etablissement", "Type": "string", "Comment": ""}, {"Name": "date_greffe", "Type": "string", "Comment": ""}, {"Name": "libelle_evt", "Type": "string", "Comment": ""}, {"Name": "type", "Type": "string", "Comment": ""}, {"Name": "siege_pm", "Type": "string", "Comment": ""}, {"Name": "rcs_registre", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne1", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne2", "Type": "string", "Comment": ""}, {"Name": "adresse_ligne3", "Type": "string", "Comment": ""}, {"Name": "code_postal", "Type": "string", "Comment": ""}, {"Name": "ville", "Type": "string", "Comment": ""}, {"Name": "code_commune", "Type": "string", "Comment": ""}, {"Name": "pays", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_nom", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_siren", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_greffe", "Type": "string", "Comment": ""}, {"Name": "domiciliataire_complement", "Type": "string", "Comment": ""}, {"Name": "siege_domicile_representant", "Type": "string", "Comment": ""}, {"Name": "nom_commercial", "Type": "string", "Comment": ""}, {"Name": "enseigne", "Type": "string", "Comment": ""}, {"Name": "activite_ambulante", "Type": "string", "Comment": ""}, {"Name": "activite_saisonniere", "Type": "string", "Comment": ""}, {"Name": "activite_non_sedentaire", "Type": "string", "Comment": ""}, {"Name": "date_debut_activite", "Type": "string", "Comment": ""}, {"Name": "activite", "Type": "string", "Comment": ""}, {"Name": "origine_fonds", "Type": "string", "Comment": ""}, {"Name": "origine_fonds_info", "Type": "string", "Comment": ""}, {"Name": "type_exploitation", "Type": "string", "Comment": ""}, {"Name": "csv_source", "Type": "string", "Comment": ""}, {"Name": "origin", "Type": "string", "Comment": ""}]}, {"database": "ets_insee", "name": "ets_insee_raw_juillet", "output_id": "f1f483d3-5fa6-4cad-bc60-fd4d72636093", "separator": ",", "s3URI": "s3://calfdata/INSEE/00_rawData/ETS_01_07_2020", "schema": [{"Name": "siren", "Type": "string", "Comment": ""}, {"Name": "nic", "Type": "string", "Comment": ""}, {"Name": "siret", "Type": "string", "Comment": ""}, {"Name": "statutdiffusionetablissement", "Type": "string", "Comment": ""}, {"Name": "datecreationetablissement", "Type": "string", "Comment": ""}, {"Name": "trancheeffectifsetablissement", "Type": "string", "Comment": ""}, {"Name": "anneeeffectifsetablissement", "Type": "string", "Comment": ""}, {"Name": "activiteprincipaleregistremetiersetablissement", "Type": "string", "Comment": ""}, {"Name": "datederniertraitementetablissement", "Type": "string", "Comment": ""}, {"Name": "etablissementsiege", "Type": "string", "Comment": ""}, {"Name": "nombreperiodesetablissement", "Type": "string", "Comment": ""}, {"Name": "complementadresseetablissement", "Type": "string", "Comment": ""}, {"Name": "numerovoieetablissement", "Type": "string", "Comment": ""}, {"Name": "indicerepetitionetablissement", "Type": "string", "Comment": ""}, {"Name": "typevoieetablissement", "Type": "string", "Comment": ""}, {"Name": "libellevoieetablissement", "Type": "string", "Comment": ""}, {"Name": "codepostaletablissement", "Type": "string", "Comment": ""}, {"Name": "libellecommuneetablissement", "Type": "string", "Comment": ""}, {"Name": "libellecommuneetrangeretablissement", "Type": "string", "Comment": ""}, {"Name": "distributionspecialeetablissement", "Type": "string", "Comment": ""}, {"Name": "codecommuneetablissement", "Type": "string", "Comment": ""}, {"Name": "codecedexetablissement", "Type": "string", "Comment": ""}, {"Name": "libellecedexetablissement", "Type": "string", "Comment": ""}, {"Name": "codepaysetrangeretablissement", "Type": "string", "Comment": ""}, {"Name": "libellepaysetrangeretablissement", "Type": "string", "Comment": ""}, {"Name": "complementadresse2etablissement", "Type": "string", "Comment": ""}, {"Name": "numerovoie2etablissement", "Type": "string", "Comment": ""}, {"Name": "indicerepetition2etablissement", "Type": "string", "Comment": ""}, {"Name": "typevoie2etablissement", "Type": "string", "Comment": ""}, {"Name": "libellevoie2etablissement", "Type": "string", "Comment": ""}, {"Name": "codepostal2etablissement", "Type": "string", "Comment": ""}, {"Name": "libellecommune2etablissement", "Type": "string", "Comment": ""}, {"Name": "libellecommuneetranger2etablissement", "Type": "string", "Comment": ""}, {"Name": "distributionspeciale2etablissement", "Type": "string", "Comment": ""}, {"Name": "codecommune2etablissement", "Type": "string", "Comment": ""}, {"Name": "codecedex2etablissement", "Type": "string", "Comment": ""}, {"Name": "libellecedex2etablissement", "Type": "string", "Comment": ""}, {"Name": "codepaysetranger2etablissement", "Type": "string", "Comment": ""}, {"Name": "libellepaysetranger2etablissement", "Type": "string", "Comment": ""}, {"Name": "datedebut", "Type": "string", "Comment": ""}, {"Name": "etatadministratifetablissement", "Type": "string", "Comment": ""}, {"Name": "enseigne1etablissement", "Type": "string", "Comment": ""}, {"Name": "enseigne2etablissement", "Type": "string", "Comment": ""}, {"Name": "enseigne3etablissement", "Type": "string", "Comment": ""}, {"Name": "denominationusuelleetablissement", "Type": "string", "Comment": ""}, {"Name": "activiteprincipaleetablissement", "Type": "string", "Comment": ""}, {"Name": "nomenclatureactiviteprincipaleetablissement", "Type": "string", "Comment": ""}, {"Name": "caractereemployeuretablissement", "Type": "string", "Comment": ""}]}], "template": {"bottom_Lazyserde": "ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe' WITH SERDEPROPERTIES ( 'serialization.format' = ',', 'field.delim' = '{0}', 'quoteChar' = '\"') LOCATION '{1}' TBLPROPERTIES ('has_encrypted_data'='false', 'skip.header.line.count'='1')", "bottom_OpenCSVSerde": "ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde' WITH SERDEPROPERTIES (  'separatorChar' = '{0}', 'quoteChar' = '\"') LOCATION '{1}' TBLPROPERTIES ('has_encrypted_data'='false', 'skip.header.line.count'='1')", "middle": "{0} {1} {2}", "top": "CREATE EXTERNAL TABLE IF NOT EXISTS {0}.{1} ("}}, "PREPARATION": {"ALL_SCHEMA": [{"STEPS_0": {"name": "Concatenation table stock", "execution": [{"database": "ets_inpi", "name": "ets_partiel", "output_id": "", "query": {"top": "WITH append AS ( SELECT * FROM ets_inpi.ets_partiel_2018", "middle": " UNION SELECT * FROM ets_inpi.ets_partiel_2019 ", "bottom": " ) SELECT * FROM append ORDER BY siren, code_greffe,nom_greffe,numero_gestion, id_etablissement, file_timestamp"}}], "schema": [{"Name": "", "Type": "", "Comment": ""}]}}, {"STEPS_1": {"name": "Concatenation table flux", "execution": [{"database": "ets_inpi", "name": "ets_flux", "output_id": "", "query": {"top": "WITH append AS ( SELECT * FROM ets_inpi.ets_new_2017", "middle": "  UNION SELECT * FROM ets_inpi.ets_new_2018 UNION SELECT * FROM ets_inpi.ets_new_2019 UNION SELECT * FROM ets_inpi.ets_evt_2017 UNION SELECT * FROM ets_inpi.ets_evt_2018 UNION SELECT * FROM ets_inpi.ets_evt_2019", "bottom": " ) SELECT * FROM append ORDER BY siren, code_greffe,nom_greffe,numero_gestion, id_etablissement, file_timestamp"}}], "schema": [{"Name": "", "Type": "", "Comment": ""}]}}, {"STEPS_2": {"name": "filtrage intra day et intra date de greffe", "execution": [{"database": "ets_inpi", "name": "", "output_id": "", "query": {"top": "WITH createID AS ( SELECT *, ROW_NUMBER() OVER ( PARTITION BY siren,code_greffe,nom_greffe,numero_gestion,id_etablissement,file_timestamp ) As row_ID, DENSE_RANK () OVER ( ORDER BY siren,code_greffe,nom_greffe,numero_gestion,id_etablissement,file_timestamp ) As ID FROM ets_inpi.ets_flux WHERE  ( code_greffe = '{}') ) ", "middle": " SELECT * FROM ( WITH filled AS ( SELECT ID, row_ID, siren,code_greffe,nom_greffe,numero_gestion,id_etablissement,file_timestamp, first_value(\"libelle_evt\") over (partition by ID, \"libelle_evt_partition\" order by ID, row_ID ) as \"libelle_evt\" ,first_value(\"date_greffe\") over (partition by ID, \"date_greffe_partition\" order by ID, row_ID ) as \"date_greffe\" ,first_value(\"type\") over (partition by ID, \"type_partition\" order by ID, row_ID ) as \"type\" ,first_value(\"siege_pm\") over (partition by ID, \"siege_pm_partition\" order by ID, row_ID ) as \"siege_pm\" ,first_value(\"rcs_registre\") over (partition by ID, \"rcs_registre_partition\" order by ID, row_ID ) as \"rcs_registre\" ,first_value(\"adresse_ligne1\") over (partition by ID, \"adresse_ligne1_partition\" order by ID, row_ID ) as \"adresse_ligne1\" ,first_value(\"adresse_ligne2\") over (partition by ID, \"adresse_ligne2_partition\" order by ID, row_ID ) as \"adresse_ligne2\" ,first_value(\"adresse_ligne3\") over (partition by ID, \"adresse_ligne3_partition\" order by ID, row_ID ) as \"adresse_ligne3\" ,first_value(\"code_postal\") over (partition by ID, \"code_postal_partition\" order by ID, row_ID ) as \"code_postal\" ,first_value(\"ville\") over (partition by ID, \"ville_partition\" order by ID, row_ID ) as \"ville\" ,first_value(\"code_commune\") over (partition by ID, \"code_commune_partition\" order by ID, row_ID ) as \"code_commune\" ,first_value(\"pays\") over (partition by ID, \"pays_partition\" order by ID, row_ID ) as \"pays\" ,first_value(\"domiciliataire_nom\") over (partition by ID, \"domiciliataire_nom_partition\" order by ID, row_ID ) as \"domiciliataire_nom\" ,first_value(\"domiciliataire_siren\") over (partition by ID, \"domiciliataire_siren_partition\" order by ID, row_ID ) as \"domiciliataire_siren\" ,first_value(\"domiciliataire_greffe\") over (partition by ID, \"domiciliataire_greffe_partition\" order by ID, row_ID ) as \"domiciliataire_greffe\" ,first_value(\"domiciliataire_complement\") over (partition by ID, \"domiciliataire_complement_partition\" order by ID, row_ID ) as \"domiciliataire_complement\" ,first_value(\"siege_domicile_representant\") over (partition by ID, \"siege_domicile_representant_partition\" order by ID, row_ID ) as \"siege_domicile_representant\" ,first_value(\"nom_commercial\") over (partition by ID, \"nom_commercial_partition\" order by ID, row_ID ) as \"nom_commercial\" ,first_value(\"enseigne\") over (partition by ID, \"enseigne_partition\" order by ID, row_ID ) as \"enseigne\" ,first_value(\"activite_ambulante\") over (partition by ID, \"activite_ambulante_partition\" order by ID, row_ID ) as \"activite_ambulante\" ,first_value(\"activite_saisonniere\") over (partition by ID, \"activite_saisonniere_partition\" order by ID, row_ID ) as \"activite_saisonniere\" ,first_value(\"activite_non_sedentaire\") over (partition by ID, \"activite_non_sedentaire_partition\" order by ID, row_ID ) as \"activite_non_sedentaire\" ,first_value(\"date_debut_activite\") over (partition by ID, \"date_debut_activite_partition\" order by ID, row_ID ) as \"date_debut_activite\" ,first_value(\"activite\") over (partition by ID, \"activite_partition\" order by ID, row_ID ) as \"activite\" ,first_value(\"origine_fonds\") over (partition by ID, \"origine_fonds_partition\" order by ID, row_ID ) as \"origine_fonds\" ,first_value(\"origine_fonds_info\") over (partition by ID, \"origine_fonds_info_partition\" order by ID, row_ID ) as \"origine_fonds_info\" ,first_value(\"type_exploitation\") over (partition by ID, \"type_exploitation_partition\" order by ID, row_ID ) as \"type_exploitation\" ,first_value(\"csv_source\") over (partition by ID, \"csv_source_partition\" order by ID, row_ID ) as \"csv_source\" FROM ( SELECT *, sum(case when \"libelle_evt\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"libelle_evt_partition\" ,sum(case when \"date_greffe\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"date_greffe_partition\" ,sum(case when \"type\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"type_partition\" ,sum(case when \"siege_pm\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"siege_pm_partition\" ,sum(case when \"rcs_registre\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"rcs_registre_partition\" ,sum(case when \"adresse_ligne1\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"adresse_ligne1_partition\" ,sum(case when \"adresse_ligne2\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"adresse_ligne2_partition\" ,sum(case when \"adresse_ligne3\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"adresse_ligne3_partition\" ,sum(case when \"code_postal\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"code_postal_partition\" ,sum(case when \"ville\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"ville_partition\" ,sum(case when \"code_commune\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"code_commune_partition\" ,sum(case when \"pays\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"pays_partition\" ,sum(case when \"domiciliataire_nom\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"domiciliataire_nom_partition\" ,sum(case when \"domiciliataire_siren\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"domiciliataire_siren_partition\" ,sum(case when \"domiciliataire_greffe\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"domiciliataire_greffe_partition\" ,sum(case when \"domiciliataire_complement\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"domiciliataire_complement_partition\" ,sum(case when \"siege_domicile_representant\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"siege_domicile_representant_partition\" ,sum(case when \"nom_commercial\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"nom_commercial_partition\" ,sum(case when \"enseigne\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"enseigne_partition\" ,sum(case when \"activite_ambulante\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"activite_ambulante_partition\" ,sum(case when \"activite_saisonniere\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"activite_saisonniere_partition\" ,sum(case when \"activite_non_sedentaire\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"activite_non_sedentaire_partition\" ,sum(case when \"date_debut_activite\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"date_debut_activite_partition\" ,sum(case when \"activite\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"activite_partition\" ,sum(case when \"origine_fonds\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"origine_fonds_partition\" ,sum(case when \"origine_fonds_info\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"origine_fonds_info_partition\" ,sum(case when \"type_exploitation\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"type_exploitation_partition\" ,sum(case when \"csv_source\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"csv_source_partition\" FROM createID ORDER BY ID, row_ID ASC ) ORDER BY ID, row_ID ) ", "bottom": " SELECT siren,code_greffe,nom_greffe,numero_gestion,id_etablissement,file_timestamp, libelle_evt,date_greffe,type,siege_pm,rcs_registre,adresse_ligne1,adresse_ligne2,adresse_ligne3,code_postal,ville,code_commune,pays,domiciliataire_nom,domiciliataire_siren,domiciliataire_greffe,domiciliataire_complement,siege_domicile_representant,nom_commercial,enseigne,activite_ambulante,activite_saisonniere,activite_non_sedentaire,date_debut_activite,activite,origine_fonds,origine_fonds_info,type_exploitation,csv_source, CASE WHEN siren IS NOT NULL THEN 'EVT' ELSE NULL END as origin FROM ( SELECT *, ROW_NUMBER() OVER( PARTITION BY ID ORDER BY ID, row_ID DESC ) AS max_value FROM filled ) AS T WHERE max_value = 1 )ORDER BY siren,code_greffe,nom_greffe,numero_gestion,id_etablissement,file_timestamp "}}], "schema": [{"Name": "", "Type": "", "Comment": ""}]}}, {"STEPS_3": {"name": "Table filtree et enrichie intermediaire date greffe", "execution": [{"database": "ets_inpi", "name": "", "output_id": "", "query": {"top": "WITH createID AS ( SELECT *, ROW_NUMBER() OVER ( PARTITION BY siren,code_greffe,nom_greffe,numero_gestion,id_etablissement,date_greffe ) As row_ID, DENSE_RANK () OVER ( ORDER BY siren,code_greffe,nom_greffe,numero_gestion,id_etablissement,date_greffe ) As ID FROM ets_inpi.ets_flux_filtre_enrichie_timestamp WHERE  ( code_greffe = '{}') ) ", "middle": " SELECT * FROM ( WITH filled AS ( SELECT ID, row_ID, siren,code_greffe,nom_greffe,numero_gestion,id_etablissement,date_greffe, first_value(\"libelle_evt\") over (partition by ID, \"libelle_evt_partition\" order by ID, row_ID ) as \"libelle_evt\" ,first_value(\"type\") over (partition by ID, \"type_partition\" order by ID, row_ID ) as \"type\" ,first_value(\"siege_pm\") over (partition by ID, \"siege_pm_partition\" order by ID, row_ID ) as \"siege_pm\" ,first_value(\"rcs_registre\") over (partition by ID, \"rcs_registre_partition\" order by ID, row_ID ) as \"rcs_registre\" ,first_value(\"adresse_ligne1\") over (partition by ID, \"adresse_ligne1_partition\" order by ID, row_ID ) as \"adresse_ligne1\" ,first_value(\"adresse_ligne2\") over (partition by ID, \"adresse_ligne2_partition\" order by ID, row_ID ) as \"adresse_ligne2\" ,first_value(\"adresse_ligne3\") over (partition by ID, \"adresse_ligne3_partition\" order by ID, row_ID ) as \"adresse_ligne3\" ,first_value(\"code_postal\") over (partition by ID, \"code_postal_partition\" order by ID, row_ID ) as \"code_postal\" ,first_value(\"ville\") over (partition by ID, \"ville_partition\" order by ID, row_ID ) as \"ville\" ,first_value(\"code_commune\") over (partition by ID, \"code_commune_partition\" order by ID, row_ID ) as \"code_commune\" ,first_value(\"pays\") over (partition by ID, \"pays_partition\" order by ID, row_ID ) as \"pays\" ,first_value(\"domiciliataire_nom\") over (partition by ID, \"domiciliataire_nom_partition\" order by ID, row_ID ) as \"domiciliataire_nom\" ,first_value(\"domiciliataire_siren\") over (partition by ID, \"domiciliataire_siren_partition\" order by ID, row_ID ) as \"domiciliataire_siren\" ,first_value(\"domiciliataire_greffe\") over (partition by ID, \"domiciliataire_greffe_partition\" order by ID, row_ID ) as \"domiciliataire_greffe\" ,first_value(\"domiciliataire_complement\") over (partition by ID, \"domiciliataire_complement_partition\" order by ID, row_ID ) as \"domiciliataire_complement\" ,first_value(\"siege_domicile_representant\") over (partition by ID, \"siege_domicile_representant_partition\" order by ID, row_ID ) as \"siege_domicile_representant\" ,first_value(\"nom_commercial\") over (partition by ID, \"nom_commercial_partition\" order by ID, row_ID ) as \"nom_commercial\" ,first_value(\"enseigne\") over (partition by ID, \"enseigne_partition\" order by ID, row_ID ) as \"enseigne\" ,first_value(\"activite_ambulante\") over (partition by ID, \"activite_ambulante_partition\" order by ID, row_ID ) as \"activite_ambulante\" ,first_value(\"activite_saisonniere\") over (partition by ID, \"activite_saisonniere_partition\" order by ID, row_ID ) as \"activite_saisonniere\" ,first_value(\"activite_non_sedentaire\") over (partition by ID, \"activite_non_sedentaire_partition\" order by ID, row_ID ) as \"activite_non_sedentaire\" ,first_value(\"date_debut_activite\") over (partition by ID, \"date_debut_activite_partition\" order by ID, row_ID ) as \"date_debut_activite\" ,first_value(\"activite\") over (partition by ID, \"activite_partition\" order by ID, row_ID ) as \"activite\" ,first_value(\"origine_fonds\") over (partition by ID, \"origine_fonds_partition\" order by ID, row_ID ) as \"origine_fonds\" ,first_value(\"origine_fonds_info\") over (partition by ID, \"origine_fonds_info_partition\" order by ID, row_ID ) as \"origine_fonds_info\" ,first_value(\"type_exploitation\") over (partition by ID, \"type_exploitation_partition\" order by ID, row_ID ) as \"type_exploitation\" ,first_value(\"csv_source\") over (partition by ID, \"csv_source_partition\" order by ID, row_ID ) as \"csv_source\" FROM ( SELECT *, sum(case when \"libelle_evt\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"libelle_evt_partition\" ,sum(case when \"type\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"type_partition\" ,sum(case when \"siege_pm\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"siege_pm_partition\" ,sum(case when \"rcs_registre\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"rcs_registre_partition\" ,sum(case when \"adresse_ligne1\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"adresse_ligne1_partition\" ,sum(case when \"adresse_ligne2\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"adresse_ligne2_partition\" ,sum(case when \"adresse_ligne3\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"adresse_ligne3_partition\" ,sum(case when \"code_postal\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"code_postal_partition\" ,sum(case when \"ville\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"ville_partition\" ,sum(case when \"code_commune\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"code_commune_partition\" ,sum(case when \"pays\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"pays_partition\" ,sum(case when \"domiciliataire_nom\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"domiciliataire_nom_partition\" ,sum(case when \"domiciliataire_siren\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"domiciliataire_siren_partition\" ,sum(case when \"domiciliataire_greffe\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"domiciliataire_greffe_partition\" ,sum(case when \"domiciliataire_complement\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"domiciliataire_complement_partition\" ,sum(case when \"siege_domicile_representant\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"siege_domicile_representant_partition\" ,sum(case when \"nom_commercial\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"nom_commercial_partition\" ,sum(case when \"enseigne\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"enseigne_partition\" ,sum(case when \"activite_ambulante\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"activite_ambulante_partition\" ,sum(case when \"activite_saisonniere\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"activite_saisonniere_partition\" ,sum(case when \"activite_non_sedentaire\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"activite_non_sedentaire_partition\" ,sum(case when \"date_debut_activite\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"date_debut_activite_partition\" ,sum(case when \"activite\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"activite_partition\" ,sum(case when \"origine_fonds\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"origine_fonds_partition\" ,sum(case when \"origine_fonds_info\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"origine_fonds_info_partition\" ,sum(case when \"type_exploitation\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"type_exploitation_partition\" ,sum(case when \"csv_source\" = '' then 0 else 1 end) over (partition by ID order by row_ID) as \"csv_source_partition\" FROM createID ORDER BY ID, row_ID ASC ) ORDER BY ID, row_ID ) ", "bottom": " SELECT siren,code_greffe,nom_greffe,numero_gestion,id_etablissement,date_greffe, libelle_evt,type,siege_pm,rcs_registre,adresse_ligne1,adresse_ligne2,adresse_ligne3,code_postal,ville,code_commune,pays,domiciliataire_nom,domiciliataire_siren,domiciliataire_greffe,domiciliataire_complement,siege_domicile_representant,nom_commercial,enseigne,activite_ambulante,activite_saisonniere,activite_non_sedentaire,date_debut_activite,activite,origine_fonds,origine_fonds_info,type_exploitation,csv_source, CASE WHEN siren IS NOT NULL THEN 'EVT' ELSE NULL END as origin FROM ( SELECT *, ROW_NUMBER() OVER( PARTITION BY ID ORDER BY ID, row_ID DESC ) AS max_value FROM filled ) AS T WHERE max_value = 1 )ORDER BY siren,code_greffe,nom_greffe,numero_gestion,id_etablissement,date_greffe"}}], "schema": [{"Name": "", "Type": "", "Comment": ""}]}}, {"STEPS_4": {"name": "ignore les status IGNORE", "execution": [{"database": "ets_inpi", "name": "ets_filtre_enrichie_historique_tmp", "output_id": "", "query": {"top": " WITH concat_ AS ( SELECT siren, code_greffe, nom_greffe, numero_gestion, id_etablissement, Coalesce( try(date_parse(date_greffe, '%Y-%m-%d')), try(date_parse(date_greffe, '%Y/%m/%d')), try(date_parse(date_greffe, '%d %M %Y')), try(date_parse(date_greffe, '%d/%m/%Y')), try(date_parse(date_greffe, '%d-%m-%Y')) ) as date_greffe, libelle_evt, type, siege_pm, rcs_registre, adresse_ligne1, adresse_ligne2, adresse_ligne3, code_postal, code_commune, pays, domiciliataire_nom, domiciliataire_siren, domiciliataire_greffe, domiciliataire_complement, siege_domicile_representant, enseigne, activite_ambulante, activite_saisonniere, activite_non_sedentaire, date_debut_activite, activite, origine_fonds, origine_fonds_info, ville, nom_commercial, type_exploitation, csv_source, 'FLUX' AS origin FROM ets_flux_filtre_enrichie_date_greffe ", "middle": " UNION ( SELECT siren, code_greffe, nom_greffe, numero_gestion, id_etablissement, Coalesce( try(date_parse(date_greffe, '%Y-%m-%d')), try(date_parse(date_greffe, '%Y/%m/%d')), try(date_parse(date_greffe, '%d %M %Y')), try(date_parse(date_greffe, '%d/%m/%Y')), try(date_parse(date_greffe, '%d-%m-%Y')) ) as date_greffe, libelle_evt, type, siege_pm, rcs_registre, adresse_ligne1, adresse_ligne2, adresse_ligne3, code_postal, code_commune, pays, domiciliataire_nom, domiciliataire_siren, domiciliataire_greffe, domiciliataire_complement, siege_domicile_representant, enseigne, activite_ambulante, activite_saisonniere, activite_non_sedentaire, date_debut_activite, activite, origine_fonds, origine_fonds_info, ville, nom_commercial, type_exploitation, csv_source, 'INITIAL' AS origin FROM ets_initial ) UNION ( SELECT date_.siren, date_.code_greffe, date_.nom_greffe, date_.numero_gestion, date_.id_etablissement, Coalesce( try(date_parse(date_greffe, '%Y-%m-%d')), try(date_parse(date_greffe, '%Y/%m/%d')), try(date_parse(date_greffe, '%d %M %Y')), try(date_parse(date_greffe, '%d/%m/%Y')), try(date_parse(date_greffe, '%d-%m-%Y')) ) as date_greffe, libelle_evt, type, siege_pm, rcs_registre, adresse_ligne1, adresse_ligne2, adresse_ligne3, code_postal, code_commune, pays, domiciliataire_nom, domiciliataire_siren, domiciliataire_greffe, domiciliataire_complement, siege_domicile_representant, enseigne, activite_ambulante, activite_saisonniere, activite_non_sedentaire, date_debut_activite, activite, origine_fonds, origine_fonds_info, ville, nom_commercial, type_exploitation, csv_source, 'PARTIEL' AS origin FROM ( SELECT siren, code_greffe, nom_greffe, numero_gestion, id_etablissement, date_greffe, type, libelle_evt, siege_pm, rcs_registre, adresse_ligne1, adresse_ligne2, adresse_ligne3, code_postal, code_commune, pays, domiciliataire_nom, domiciliataire_siren, domiciliataire_greffe, domiciliataire_complement, siege_domicile_representant, enseigne, activite_ambulante, activite_saisonniere, activite_non_sedentaire, date_debut_activite, activite, origine_fonds, origine_fonds_info, ville, nom_commercial, type_exploitation, csv_source, Coalesce( try( cast(file_timestamp as timestamp) ) ) as file_timestamp FROM ets_partiel ) as date_ INNER JOIN ( SELECT siren, code_greffe, nom_greffe, numero_gestion, id_etablissement, MAX( Coalesce( try( cast(file_timestamp as timestamp) ) ) ) as file_timestamp FROM ets_partiel GROUP BY siren, code_greffe, nom_greffe, numero_gestion, id_etablissement ) as max_ ON date_.siren = max_.siren AND date_.code_greffe = max_.code_greffe AND date_.nom_greffe = max_.nom_greffe AND date_.numero_gestion = max_.numero_gestion AND date_.id_etablissement = max_.id_etablissement AND date_.file_timestamp = max_.file_timestamp ) ORDER BY siren, code_greffe, nom_greffe, numero_gestion, id_etablissement, date_greffe ) ", "bottom": " SELECT concat_.siren, concat_.code_greffe, concat_.nom_greffe, concat_.numero_gestion, concat_.id_etablissement, libelle_evt, date_greffe, type, siege_pm, rcs_registre, adresse_ligne1, adresse_ligne2, adresse_ligne3, code_postal, code_commune, pays, domiciliataire_nom, domiciliataire_siren, domiciliataire_greffe, domiciliataire_complement, siege_domicile_representant, enseigne, activite_ambulante, activite_saisonniere, activite_non_sedentaire, date_debut_activite, activite, origine_fonds, origine_fonds_info, ville, nom_commercial, type_exploitation, csv_source, origin, CASE WHEN date_greffe <= date_greffe_max AND origin != 'PARTIEL' THEN 'IGNORE' ELSE NULL END as status FROM concat_ LEFT JOIN ( SELECT siren, code_greffe, nom_greffe, numero_gestion, id_etablissement, date_greffe as date_greffe_max FROM concat_ WHERE origin = 'PARTIEL' ) as partiel ON concat_.siren = partiel.siren AND concat_.code_greffe = partiel.code_greffe AND concat_.nom_greffe = partiel.nom_greffe AND concat_.numero_gestion = partiel.numero_gestion AND concat_.id_etablissement = partiel.id_etablissement"}}], "schema": [{"Name": "", "Type": "", "Comment": ""}]}}, {"STEPS_5": {"name": "Enrichissement des flux sur variable n et n-1", "execution": [{"database": "ets_inpi", "name": "ets_filtre_enrichie_historique", "output_id": "731cae1d-d81f-4974-8dcf-57eefd0dcb8b", "query": {"top": "SELECT siren, code_greffe, nom_greffe, numero_gestion, id_etablissement, origin, status, date_greffe, libelle_evt,", "middle": " CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"type\" = '' THEN LAG (\"type\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"type\" END AS \"type\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"siege_pm\" = '' THEN LAG (\"siege_pm\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"siege_pm\" END AS \"siege_pm\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"rcs_registre\" = '' THEN LAG (\"rcs_registre\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"rcs_registre\" END AS \"rcs_registre\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"adresse_ligne1\" = '' THEN LAG (\"adresse_ligne1\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"adresse_ligne1\" END AS \"adresse_ligne1\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"adresse_ligne2\" = '' THEN LAG (\"adresse_ligne2\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"adresse_ligne2\" END AS \"adresse_ligne2\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"adresse_ligne3\" = '' THEN LAG (\"adresse_ligne3\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"adresse_ligne3\" END AS \"adresse_ligne3\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"code_postal\" = '' THEN LAG (\"code_postal\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"code_postal\" END AS \"code_postal\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"ville\" = '' THEN LAG (\"ville\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"ville\" END AS \"ville\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"code_commune\" = '' THEN LAG (\"code_commune\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"code_commune\" END AS \"code_commune\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"pays\" = '' THEN LAG (\"pays\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"pays\" END AS \"pays\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"domiciliataire_nom\" = '' THEN LAG (\"domiciliataire_nom\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"domiciliataire_nom\" END AS \"domiciliataire_nom\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"domiciliataire_siren\" = '' THEN LAG (\"domiciliataire_siren\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"domiciliataire_siren\" END AS \"domiciliataire_siren\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"domiciliataire_greffe\" = '' THEN LAG (\"domiciliataire_greffe\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"domiciliataire_greffe\" END AS \"domiciliataire_greffe\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"domiciliataire_complement\" = '' THEN LAG (\"domiciliataire_complement\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"domiciliataire_complement\" END AS \"domiciliataire_complement\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"siege_domicile_representant\" = '' THEN LAG (\"siege_domicile_representant\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"siege_domicile_representant\" END AS \"siege_domicile_representant\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"nom_commercial\" = '' THEN LAG (\"nom_commercial\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"nom_commercial\" END AS \"nom_commercial\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"enseigne\" = '' THEN LAG (\"enseigne\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"enseigne\" END AS \"enseigne\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"activite_ambulante\" = '' THEN LAG (\"activite_ambulante\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"activite_ambulante\" END AS \"activite_ambulante\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"activite_saisonniere\" = '' THEN LAG (\"activite_saisonniere\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"activite_saisonniere\" END AS \"activite_saisonniere\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"activite_non_sedentaire\" = '' THEN LAG (\"activite_non_sedentaire\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"activite_non_sedentaire\" END AS \"activite_non_sedentaire\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"date_debut_activite\" = '' THEN LAG (\"date_debut_activite\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"date_debut_activite\" END AS \"date_debut_activite\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"activite\" = '' THEN LAG (\"activite\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"activite\" END AS \"activite\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"origine_fonds\" = '' THEN LAG (\"origine_fonds\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"origine_fonds\" END AS \"origine_fonds\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"origine_fonds_info\" = '' THEN LAG (\"origine_fonds_info\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"origine_fonds_info\" END AS \"origine_fonds_info\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"type_exploitation\" = '' THEN LAG (\"type_exploitation\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"type_exploitation\" END AS \"type_exploitation\" , CASE WHEN origin = 'FLUX' AND status != 'IGNORE' AND \"csv_source\" = '' THEN LAG (\"csv_source\", 1) OVER ( PARTITION BY siren,\"code_greffe\", numero_gestion, id_etablissement ORDER BY siren,'code_greffe', numero_gestion, id_etablissement,date_greffe ) ELSE \"csv_source\" END AS \"csv_source\" ", "bottom": " FROM ets_filtre_enrichie_historique_tmp ORDER BY siren,code_greffe, numero_gestion, id_etablissement,date_greffe "}}], "schema": [{"Name": "", "Type": "", "Comment": ""}]}}, {"STEPS_6": {"name": "Creation sequence caracterisant un \u00e9tablissement au sens de l'INPI", "execution": [{"database": "ets_inpi", "name": "ets_inpi_transformed_temp", "output_id": "196767de-b20c-4f3e-a273-28b1d0caeffc", "query": {"top": " WITH cte AS ( SELECT siren, code_greffe, nom_greffe, numero_gestion, id_etablissement, sequence_id, ROW_NUMBER() OVER ( PARTITION BY sequence_id ORDER BY sequence_id) as rownum FROM ( SELECT siren, code_greffe, nom_greffe, numero_gestion, id_etablissement, DENSE_RANK () OVER( ORDER BY siren, code_greffe, nom_greffe, numero_gestion, id_etablissement) AS sequence_id FROM ets_filtre_enrichie_historique ) ) ", "middle": " SELECT ROW_NUMBER() OVER () as index_id, sequence_id, ets_filtre_enrichie_historique.siren, ets_filtre_enrichie_historique.code_greffe, ets_filtre_enrichie_historique.nom_greffe, ets_filtre_enrichie_historique.numero_gestion, ets_filtre_enrichie_historique.id_etablissement, status, origin, date_greffe, libelle_evt, type, siege_pm, rcs_registre, adresse_ligne1, adresse_ligne2, adresse_ligne3, code_postal, ville, code_commune, pays, domiciliataire_nom, domiciliataire_siren, domiciliataire_greffe, domiciliataire_complement, siege_domicile_representant, nom_commercial, enseigne, activite_ambulante, activite_saisonniere, activite_non_sedentaire, date_debut_activite, activite, origine_fonds, origine_fonds_info, type_exploitation, csv_source FROM ets_filtre_enrichie_historique INNER JOIN ( ", "bottom": " SELECT * FROM cte WHERE rownum = 1 ) as no_dup_cte ON ets_filtre_enrichie_historique.siren = no_dup_cte.siren AND ets_filtre_enrichie_historique.code_greffe = no_dup_cte.code_greffe AND ets_filtre_enrichie_historique.nom_greffe = no_dup_cte.nom_greffe AND ets_filtre_enrichie_historique.numero_gestion = no_dup_cte.numero_gestion AND ets_filtre_enrichie_historique.id_etablissement = no_dup_cte.id_etablissement "}}], "schema": [{"Name": "", "Type": "", "Comment": ""}]}}, {"STEPS_7": {"name": "Creation variables simple et le status administratif d'un etablissement", "execution": [{"database": "ets_inpi", "name": "ets_inpi_transformed", "output_id": "efd5a451-6dd3-46c1-9fee-d6edd9036d5c", "query": {"top": "WITH create_var AS ( SELECT index_id, ets_inpi_transformed_temp.sequence_id, ets_inpi_transformed_temp.siren, ets_inpi_transformed_temp.code_greffe, ets_inpi_transformed_temp.nom_greffe, ets_inpi_transformed_temp.numero_gestion, ets_inpi_transformed_temp.id_etablissement, status, origin, date_greffe, libelle_evt, last_libele_evt, CASE WHEN last_libele_evt = 'Etablissement supprim\u00e9' THEN 'F' ELSE 'A' END AS status_admin, type, CASE WHEN type = 'SIE' OR type = 'SEP' THEN 'true' ELSE 'false' END AS status_ets, siege_pm, rcs_registre, adresse_ligne1, adresse_ligne2, adresse_ligne3, REGEXP_REPLACE( trim( REGEXP_REPLACE( REGEXP_REPLACE( NORMALIZE( UPPER( CONCAT( adresse_ligne1, ' ', adresse_ligne2, ' ', adresse_ligne3 ) ), NFD ), '\\pM', '' ), '[^\\w\\s]| +', ' ' ) ), '\\s+\\s+', ' ' ) AS adresse_reconstituee_inpi , regexp_replace( trim( REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( NORMALIZE( UPPER( CONCAT( adresse_ligne1, ' ', adresse_ligne2, ' ', adresse_ligne3 ) ), NFD ), '\\pM', '' ), '[^\\w\\s]|\\d+| +', ' ' ), '(?:^|(?<= ))(AU|AUX|AVEC|CE|CES|DANS|DE|DES|DU|ELLE|EN|ET|EUX|IL|ILS|LA|LE|LES)(?:(?= )|$)', '' ) ), '\\s+\\s+', ' ' ) AS adresse_distance_inpi, array_distinct( regexp_extract_all( trim( REGEXP_REPLACE( REGEXP_REPLACE( NORMALIZE( UPPER( CONCAT( adresse_ligne1, ' ', adresse_ligne2, ' ', adresse_ligne3 ) ), NFD ), '\\pM', '' ), '[^\\w\\s]| +', ' ' ) ), '[0-9]+' ) ) AS list_numero_voie_matching_inpi, code_postal, CASE WHEN code_postal = '' THEN REGEXP_EXTRACT(ville, '\\d{5}') WHEN LENGTH(code_postal) = 5 THEN code_postal ELSE NULL END AS code_postal_matching, ville, REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( NORMALIZE( UPPER(ville), NFD ), '\\pM', '' ), '^\\d+\\s|\\s\\d+\\s|\\s\\d+$', '' ), '^LA\\s+|^LES\\s+|^LE\\s+|\\(.*\\)|^L(ES|A|E) | L(ES|A|E) | L(ES|A|E)$|CEDEX | CEDEX | CEDEX|^E[R*] | E[R*] | E[R*]$', '' ), '^STE | STE | STE$|^STES | STES | STES', 'SAINTE' ), '^ST | ST | ST$', 'SAINT' ), 'S/|^S | S | S$', 'SUR' ), '/S', 'SOUS' ), '[^\\w\\s]|\\([^()]*\\)|ER ARRONDISSEMENT|E ARRONDISSEMENT||^SUR$|CEDEX|[0-9]+|\\s+', '' ), 'MARSEILLEE', 'MARSEILLE' ) as ville_matching, code_commune, pays, domiciliataire_nom, domiciliataire_siren, domiciliataire_greffe, domiciliataire_complement, siege_domicile_representant, nom_commercial, UPPER(enseigne) as enseigne, activite_ambulante, activite_saisonniere, activite_non_sedentaire, date_debut_activite, activite, origine_fonds, origine_fonds_info, type_exploitation, csv_source FROM ets_inpi_transformed_temp", "middle": " INNER JOIN ( SELECT ets_inpi_transformed_temp.sequence_id, ets_inpi_transformed_temp.libelle_evt as last_libele_evt, max_date_greffe FROM ets_inpi_transformed_temp INNER JOIN ( SELECT sequence_id, MAX(date_greffe) as max_date_greffe FROM ets_inpi_transformed_temp GROUP BY sequence_id ) AS temp ON temp.sequence_id = ets_inpi_transformed_temp.sequence_id AND temp.max_date_greffe = ets_inpi_transformed_temp.date_greffe ) as max_date ON max_date.sequence_id = ets_inpi_transformed_temp.sequence_id ) ", "bottom": " SELECT index_id, sequence_id, siren, code_greffe, nom_greffe, numero_gestion, id_etablissement, status, origin, date_greffe, libelle_evt, last_libele_evt, status_admin, type, status_ets, siege_pm, rcs_registre, adresse_ligne1, adresse_ligne2, adresse_ligne3, adresse_reconstituee_inpi, adresse_distance_inpi, CASE WHEN cardinality(list_numero_voie_matching_inpi) = 0 THEN NULL ELSE list_numero_voie_matching_inpi END as list_numero_voie_matching_inpi, code_postal, code_postal_matching, ville_matching, code_commune, pays, domiciliataire_nom, domiciliataire_siren, domiciliataire_greffe, domiciliataire_complement, siege_domicile_representant, nom_commercial, enseigne, activite_ambulante, activite_saisonniere, activite_non_sedentaire, date_debut_activite, activite, origine_fonds, origine_fonds_info, type_exploitation, csv_source FROM create_var "}}], "schema": [{"Name": "", "Type": "", "Comment": ""}]}}, {"STEPS_8": {"name": "Creation des variables pour la r\u00e9alisation des tests pour la siretisation", "execution": [{"database": "ets_insee", "name": "ets_insee_transformed", "output_id": "", "query": {"top": " WITH remove_empty_siret AS ( SELECT siren, siret, dateCreationEtablissement, etablissementSiege, etatAdministratifEtablissement, complementAdresseEtablissement, numeroVoieEtablissement, indiceRepetitionEtablissement, CASE WHEN indiceRepetitionEtablissement = 'B' THEN 'BIS' WHEN indiceRepetitionEtablissement = 'T' THEN 'TER' WHEN indiceRepetitionEtablissement = 'Q' THEN 'QUATER' WHEN indiceRepetitionEtablissement = 'C' THEN 'QUINQUIES' ELSE indiceRepetitionEtablissement END as indiceRepetitionEtablissement_full, typeVoieEtablissement, libelleVoieEtablissement, codePostalEtablissement, libelleCommuneEtablissement, libelleCommuneEtrangerEtablissement, distributionSpecialeEtablissement, codeCommuneEtablissement, codeCedexEtablissement, libelleCedexEtablissement, codePaysEtrangerEtablissement, libellePaysEtrangerEtablissement, enseigne1Etablissement, enseigne2Etablissement, enseigne3Etablissement, array_remove( array_distinct( SPLIT( concat( enseigne1etablissement, ',', enseigne2etablissement, ',', enseigne3etablissement ), ',' ) ), '' ) as list_enseigne FROM ets_insee.ets_insee_raw_juillet ) ", "middle": " SELECT * FROM ( WITH concat_adress AS( SELECT siren, siret, dateCreationEtablissement, etablissementSiege, etatAdministratifEtablissement, codePostalEtablissement, codeCommuneEtablissement, libelleCommuneEtablissement, ville_matching, numeroVoieEtablissement, array_distinct( regexp_extract_all( REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( CONCAT( COALESCE(numeroVoieEtablissement, ''), ' ', COALESCE( indiceRepetitionEtablissement_full, '' ), ' ', COALESCE(voie_clean, ''), ' ', COALESCE(libelleVoieEtablissement, ''), ' ', COALESCE( complementAdresseEtablissement, '' ) ), '[^\\w\\s]| +', ' ' ), '(?:^|(?<= ))(AU|AUX|AVEC|CE|CES|DANS|DE|DES|DU|ELLE|EN|ET|EUX|IL|ILS|LA|LE|LES)(?:(?= )|$)', '' ), '\\s+\\s+', ' ' ), '[0-9]+' ) ) AS list_numero_voie_matching_insee, typeVoieEtablissement, voie_clean, libelleVoieEtablissement, complementAdresseEtablissement, indiceRepetitionEtablissement_full, REGEXP_REPLACE( NORMALIZE( UPPER( trim( REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( CONCAT( COALESCE(numeroVoieEtablissement, ''), ' ', COALESCE( indiceRepetitionEtablissement_full, '' ), ' ', COALESCE(voie_clean, ''), ' ', COALESCE(libelleVoieEtablissement, ''), ' ', COALESCE( complementAdresseEtablissement, '' ) ), '[^\\w\\s]| +', ' ' ), '\\s\\s+', ' ' ), '^\\s+|\\s+$', '' ) ) ), NFD ), '\\pM', '' ) AS adresse_reconstituee_insee, REGEXP_REPLACE( NORMALIZE( UPPER( REGEXP_REPLACE( trim( REGEXP_REPLACE( REGEXP_REPLACE( CONCAT( COALESCE(numeroVoieEtablissement, ''), ' ', COALESCE( indiceRepetitionEtablissement_full, '' ), ' ', COALESCE(voie_clean, ''), ' ', COALESCE(libelleVoieEtablissement, ''), ' ', COALESCE( complementAdresseEtablissement, '' ) ), '[^\\w\\s]|\\d+| +', ' ' ), '(?:^|(?<= ))(AU|AUX|AVEC|CE|CES|DANS|DE|DES|DU|ELLE|EN|ET|EUX|IL|ILS|LA|LE|LES)(?:(?= )|$)', '' ) ), '\\s+\\s+', ' ' ) ), NFD ), '\\pM', '' ) AS adresse_distance_insee, enseigne1Etablissement, enseigne2Etablissement, enseigne3Etablissement, list_enseigne FROM ( SELECT siren, siret, dateCreationEtablissement, etablissementSiege, etatAdministratifEtablissement, codePostalEtablissement, codeCommuneEtablissement, libelleCommuneEtablissement, REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( REGEXP_REPLACE( libelleCommuneEtablissement, '^\\d+\\s|\\s\\d+\\s|\\s\\d+$', '' ), '^LA\\s+|^LES\\s+|^LE\\s+|\\(.*\\)|^L(ES|A|E) | L(ES|A|E) | L(ES|A|E)$|CEDEX | CEDEX | CEDEX|^E[R*] | E[R*] | E[R*]$', '' ), '^STE | STE | STE$|^STES | STES | STES', 'SAINTE' ), '^ST | ST | ST$', 'SAINT' ), 'S/|^S | S | S$', 'SUR' ), '/S', 'SOUS' ), '[^\\w\\s]|\\([^()]*\\)|ER ARRONDISSEMENT|E ARRONDISSEMENT||^SUR$|CEDEX|[0-9]+|\\s+', '' ) as ville_matching, libelleVoieEtablissement, complementAdresseEtablissement, numeroVoieEtablissement, indiceRepetitionEtablissement_full, typeVoieEtablissement, enseigne1Etablissement, enseigne2Etablissement, enseigne3Etablissement, list_enseigne FROM remove_empty_siret ) LEFT JOIN inpi.type_voie ON typevoieetablissement = type_voie.voie_matching ) ", "bottom": " SELECT count_initial_insee, concat_adress.siren, siret, dateCreationEtablissement, etablissementSiege, etatAdministratifEtablissement, codePostalEtablissement, codeCommuneEtablissement, libelleCommuneEtablissement, ville_matching, libelleVoieEtablissement, complementAdresseEtablissement, numeroVoieEtablissement, CASE WHEN cardinality( list_numero_voie_matching_insee ) = 0 THEN NULL ELSE list_numero_voie_matching_insee END as list_numero_voie_matching_insee, indiceRepetitionEtablissement_full, typeVoieEtablissement, voie_clean, adresse_reconstituee_insee, adresse_distance_insee, enseigne1Etablissement, enseigne2Etablissement, enseigne3Etablissement, CASE WHEN cardinality(list_enseigne) = 0 THEN NULL ELSE list_enseigne END AS list_enseigne FROM concat_adress LEFT JOIN ( SELECT siren, COUNT(siren) as count_initial_insee FROM concat_adress GROUP BY siren ) as count_siren ON concat_adress.siren = count_siren.siren ) "}}], "schema": [{"Name": "", "Type": "", "Comment": ""}]}}], "template": {"top": "CREATE TABLE {}.{} WITH (format = 'PARQUET') AS "}}}, "ANALYSIS": {"COUNT_MISSING": {"top": "SELECT COUNT(*) as nb_obs, ", "middle": "COUNT(*) - COUNT({0}) AS {0}", "bottom": " FROM {}.{}"}, "CATEGORICAL": {"PAIR": "SELECT {2}, COUNT(*) AS nb_obs FROM {0}.{1} GROUP BY {2} ORDER BY nb_obs DESC ", "MULTI_PAIR": "SELECT {2}, {3}, COUNT(*) AS nb_obs FROM {0}.{1} GROUP BY {2}, {3} ORDER BY nb_obs DESC "}, "CONTINUOUS": {"DISTRIBUTION": {"top_1": "SELECT * FROM (WITH table_wrapper AS (", "top_2": ") SELECT table_wrapper.pct,", "top_3": " FROM table_wrapper ", "middle_1": "  LEFT JOIN ( ", "middle_2": " ) as table_2_{0} ON table_wrapper.pct = table_2_{0}.pct ", "bottom": "WITH table_{3} AS ( SELECT MAP( ARRAY[0.25, 0.50, 0.75, 0.95, 0.99], approx_percentile( {2}, ARRAY[0.25, 0.50, 0.75, 0.95, 0.99] ) ) as nest FROM {0}.{1} ) SELECT pct, value AS {2} FROM table_{3} CROSS JOIN UNNEST(nest) AS t(pct, value)"}, "ONE_PAIR_DISTRIBUTION": {"top_1": "SELECT * FROM (WITH table_wrapper AS (", "top_2": ") SELECT table_wrapper.pct, table_wrapper.{}, ", "top_3": " FROM table_wrapper ", "middle_1": "  LEFT JOIN ( ", "middle_2": " ) as table_2_{0} ON table_wrapper.{1} = table_2_{0}.{1} AND table_wrapper.pct = table_2_{0}.pct ", "bottom": "WITH table_{3} AS ( SELECT {4}, MAP(ARRAY[0.25, 0.50, 0.75, 0.95, 0.99], approx_percentile( {2}, ARRAY[0.25, 0.50, 0.75, 0.95, 0.99] ) ) as nest FROM {0}.{1} GROUP BY {4}) SELECT {4}, pct, value AS {2} FROM table_{3} CROSS JOIN UNNEST(nest) AS t(pct, value)"}, "TWO_PAIRS_DISTRIBUTION": "WITH dataset AS ( SELECT {2}, {3}, MAP( ARRAY[0.25, 0.50, 0.75, 0.95, 0.99], approx_percentile( {4}, ARRAY[0.25, 0.50, 0.75, 0.95, 0.99] ) ) as nest FROM {0}.{1} GROUP BY {2}, {3} ) SELECT {2}, {3}, pct, value AS {4} FROM dataset CROSS JOIN UNNEST(nest) AS t(pct, value)"}}}